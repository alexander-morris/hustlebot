{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import{getFirestore,collection,addDoc,serverTimestamp}from'firebase/firestore';import{getApp}from'firebase/app';export var generateReferralCode=function(){var _ref=_asyncToGenerator(_regeneratorRuntime.mark(function _callee(userId){var code,app,db,docData,tempCode;return _regeneratorRuntime.wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;console.log('Generating referral code for user:',userId);code=generateUniqueCode();console.log('Generated unique code:',code);try{app=getApp();db=getFirestore(app);docData={code:code,createdBy:userId,createdAt:serverTimestamp(),expiresAt:new Date(Date.now()+48*60*60*1000),used:false,usedBy:null};addDoc(collection(db,'referralCodes'),docData).then(function(){return console.log('Successfully saved referral code to Firestore');})[\"catch\"](function(error){return console.error('Failed to save to Firestore:',error);});}catch(error){console.error('Firestore setup error:',error);}return _context.abrupt(\"return\",code);case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.error('Error generating referral code:',_context.t0);tempCode=generateUniqueCode();console.log('Returning temporary code due to error:',tempCode);return _context.abrupt(\"return\",tempCode);case 14:case\"end\":return _context.stop();}},_callee,null,[[0,8]]);}));return function generateReferralCode(_x){return _ref.apply(this,arguments);};}();export function generateUniqueCode(){var chars='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';var segments=3;var segmentLength=4;var code='';for(var i=0;i<segments;i++){for(var j=0;j<segmentLength;j++){code+=chars.charAt(Math.floor(Math.random()*chars.length));}if(i<segments-1)code+='-';}return code;}","map":{"version":3,"names":["getFirestore","collection","addDoc","serverTimestamp","getApp","generateReferralCode","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","userId","code","app","db","docData","tempCode","wrap","_callee$","_context","prev","next","console","log","generateUniqueCode","createdBy","createdAt","expiresAt","Date","now","used","usedBy","then","error","abrupt","t0","stop","_x","apply","arguments","chars","segments","segmentLength","i","j","charAt","Math","floor","random","length"],"sources":["/Users/almorris/cursor-test/frontend/src/utils/referralUtils.js"],"sourcesContent":["import { getFirestore, collection, addDoc, serverTimestamp } from 'firebase/firestore';\nimport { getApp } from 'firebase/app';\n\nexport const generateReferralCode = async (userId) => {\n  try {\n    console.log('Generating referral code for user:', userId);\n    \n    // Generate a unique code\n    const code = generateUniqueCode();\n    console.log('Generated unique code:', code);\n    \n    // Try to save to Firestore but don't block on failure\n    try {\n      const app = getApp();\n      const db = getFirestore(app);\n      \n      const docData = {\n        code,\n        createdBy: userId,\n        createdAt: serverTimestamp(),\n        expiresAt: new Date(Date.now() + 48 * 60 * 60 * 1000),\n        used: false,\n        usedBy: null\n      };\n      \n      // Attempt to save but don't await\n      addDoc(collection(db, 'referralCodes'), docData)\n        .then(() => console.log('Successfully saved referral code to Firestore'))\n        .catch(error => console.error('Failed to save to Firestore:', error));\n    } catch (error) {\n      console.error('Firestore setup error:', error);\n    }\n    \n    return code;\n  } catch (error) {\n    console.error('Error generating referral code:', error);\n    const tempCode = generateUniqueCode();\n    console.log('Returning temporary code due to error:', tempCode);\n    return tempCode;\n  }\n};\n\nexport function generateUniqueCode() {\n  // Generate a code format: XXXX-XXXX-XXXX\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n  const segments = 3;\n  const segmentLength = 4;\n  \n  let code = '';\n  for (let i = 0; i < segments; i++) {\n    for (let j = 0; j < segmentLength; j++) {\n      code += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    if (i < segments - 1) code += '-';\n  }\n  \n  return code;\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}